name: Dependency Submission
on:
  # Trigger on push to the main branch
  push:
    branches:
      - main
  # Allow manual trigger for testing
  workflow_dispatch:

permissions:
  contents: write # Required for submitting the snapshot to GitHub

jobs:
  submit-dependencies:
    runs-on: ubuntu-latest

    env:
      SNAPSHOT_FILE_PATH: 'output.json'
    
    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ› ï¸ Set up Node.js
        uses: actions/setup-node@v4
        with:
          # Use an actively supported LTS version for better compatibility
          node-version: '20' 
          
      - name: ğŸ“¦ Install Dependencies & Update Lock File (Secure)
        # Guarantees package-lock.json is up-to-date. --ignore-scripts maintains security.
        run: npm install --ignore-scripts --force-lock

      - name: âš™ï¸ Generate and Submit Dependency Snapshot
        # ğŸ”‘ CORRECTED ACTION PATH IS HERE ğŸ”‘
        uses: github/dependency-submission-action@06ad90ff0e713600ab81e59273c5b525d808d249
        with:
          # Writes the snapshot to the path defined in the env block
          output-json-file: ${{ env.SNAPSHOT_FILE_PATH }}

      - name: â¬†ï¸ Upload Dependency Snapshot Artifact
        uses: actions/upload-artifact@v4
        with:
          name: dependency-snapshot
          path: ${{ env.SNAPSHOT_FILE_PATH }}
          retention-days: 5