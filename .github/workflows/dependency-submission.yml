name: Dependency Submission
on:
  # Trigger on push to the main branch
  push:
    branches:
      - main
  # Allow manual trigger for testing
  workflow_dispatch:

permissions:
  contents: write

jobs:
  submit-dependencies:
    runs-on: ubuntu-latest

    env:
      SNAPSHOT_FILE_PATH: 'dependency-snapshot.json'
    
    # Optional: Use a matrix if you have a huge number of subdirectories
    # and want to parallelize the scan, but usually not needed for NPM.

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4
        
      - name: üõ†Ô∏è Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '12' # Use your project's required Node version
          
      - name: üì¶ Install Dependencies (Skip Install Scripts)
        # This command is critical as it resolves all dependencies, 
        # including those in sub-directories/workspaces, and updates lock files.
        run: npm install --production --no-cache

      - name: ‚¨ÜÔ∏è Upload Dependency Snapshot Artifact
        uses: actions/upload-artifact@v4
        with:
          name: output
          path: ${{ env.SNAPSHOT_FILE_PATH }}
          # Optional: Only keep the artifact for 5 days
          retention-days: 5
