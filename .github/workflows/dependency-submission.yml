name: Dependency Submission
on:
  # Trigger on push to the main branch
  push:
    branches:
      - main
  # Allow manual trigger for testing
  workflow_dispatch:

permissions:
  contents: write

jobs:
  submit-dependencies:
    runs-on: ubuntu-latest
    
    # Optional: Use a matrix if you have a huge number of subdirectories
    # and want to parallelize the scan, but usually not needed for NPM.

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4
        
      - name: üõ†Ô∏è Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use your project's required Node version
          
      - name: üì¶ Install Dependencies (Root and Workspaces)
        # This command is critical as it resolves all dependencies, 
        # including those in sub-directories/workspaces, and updates lock files.
        run: npm install --ignore-scripts 
        
      - name: ‚öôÔ∏è Generate and Submit Dependency Snapshot
        # This step uses a third-party action to read the lock files, 
        # map the dependencies, and submit them to the GitHub Dependency Graph.
        # NOTE: You may need to replace this with a specific action like 
        # one that supports your monorepo tool (e.g., Lerna, Nx, etc.) 
        # or a generic NPM snapshot tool.
        uses: advanced-security/component-detection-dependency-submission-action@v0.1.0
        with:
          # The token needs 'write' access to the repository's 'contents' scope
          github-token: ${{ secrets.GITHUB_TOKEN }}
          
          # Optional: Specify the package manager if the action needs it.
          # package-manager: 'npm'